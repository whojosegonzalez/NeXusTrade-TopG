// This is the blueprint for our Twin Engine Database
// [cite: 97] Using SQLite in WAL mode for performance

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL") // This is overridden dynamically by our client.ts
}

// 1. Session: Tracks a "Run" (Live or Sim) [cite: 100]
// Acts as the parent record for all activity in a trading session.
model Session {
  id             String      @id @default(uuid())
  createdAt      DateTime    @default(now())
  endedAt        DateTime?
  strategy       String      // e.g., "Momentum-v1"
  isSimulation   Boolean     // Safety flag: TRUE if using simulation DB
  startBalance   Float       
  currentBalance Float
  targetProfit   Float       // Logic will stop if this is hit
  stopLoss       Float       // Logic will hard stop if this is hit
  status         String      // ACTIVE, COMPLETED, STOPPED
  trades         Trade[]     // Relation to Trade table
  logs           SystemLog[] // Relation to Log table
}

// 2. Trade: The Financial Ledger [cite: 106]
// Tracks every buy and sell, linking it to the session.
model Trade {
  id            String    @id @default(uuid())
  sessionId     String
  session       Session   @relation(fields: [sessionId], references: [id])
  
  tokenMint     String
  tokenSymbol   String
  
  // Buy Side
  buyTimestamp  DateTime  @default(now())
  buyPrice      Float
  buyAmount     Float     // Number of tokens
  buyCostSol    Float     // Total SOL spent including fees
  buyTxHash     String?
  
  // Sell Side
  sellTimestamp DateTime?
  sellPrice     Float?
  sellValueSol  Float?    // Total SOL received
  sellTxHash    String?
  
  // Outcome
  status        String    // OPEN, CLOSED, FAILED
  pnlSol        Float?    // Net Profit/Loss in SOL
  pnlPercent    Float?    // Net Profit/Loss in %
  
  // Audit [cite: 107]
  feesPaid      Float?    // Critical for real P/L tracking
}

// 3. TokenRadar: The Scanner Logs [cite: 103]
// Tracks tokens we SAW but maybe didn't buy. crucial for optimizing filters.
model TokenRadar {
  id           String   @id @default(uuid())
  mint         String   @unique
  symbol       String
  detectedAt   DateTime @default(now())
  source       String   // "Helius", "DexScreener"
  
  liquidityUsd Float
  volume24h    Float
  riskScore    Int      // 0-100
  
  decision     String   // BOUGHT, REJECTED_RISK, REJECTED_VOLUME
}

// 4. SystemLog: The Terminal Output [cite: 110]
// Replaces console.log so we can show it in the GUI later.
model SystemLog {
  id        String   @id @default(uuid())
  timestamp DateTime @default(now())
  sessionId String?
  session   Session? @relation(fields: [sessionId], references: [id])
  
  level     String   // INFO, SUCCESS, WARN, ERROR
  message   String
  context   String?  // JSON data
}