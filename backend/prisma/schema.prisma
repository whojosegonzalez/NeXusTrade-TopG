
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model Session {
  id             String       @id @default(uuid())
  status         String       // ACTIVE, COMPLETED, WIND_DOWN
  startBalance   Float
  currentBalance Float
  targetProfit   Float
  stopLoss       Float
  startTime      DateTime     @default(now())
  endTime        DateTime?
  configSnapshot String       // JSON string of maxPositions, tradeSize, etc.
  trades         Trade[]
  snapshots      PLSnapshot[] // Link to equity curve
}

model TokenRadar {
  id           String   @id @default(uuid())
  mint         String   @unique
  symbol       String
  liquidityUSD Float
  volume24h    Float
  riskScore    Int
  decision     String   // ACCEPTED, REJECTED_RISK, REJECTED_RUG
  rejectReason String?
  detectedAt   DateTime @default(now())
  source       String   @default("HELIUS") // HELIUS, DEXSCREENER, etc.
}

model Trade {
  id            String    @id @default(uuid())
  session       Session   @relation(fields: [sessionId], references: [id])
  sessionId     String
  mint          String
  symbol        String
  // Buy Side
  buyPrice      Float
  buyAmount     Float
  buyCostSOL    Float
  buyTimestamp  DateTime  @default(now())
  buyTxHash     String?   // For Phase 4
  // Sell Side
  sellPrice     Float?
  sellAmount    Float?
  sellValueSOL  Float?
  sellTimestamp DateTime?
  sellTxHash    String?   // For Phase 4
  // P/L
  pnlSOL        Float?
  pnlPercent    Float?
  status        String    // OPEN, CLOSED
}

// NEW: For "Terminal" view and debugging
model SystemLog {
  id        String   @id @default(uuid())
  timestamp DateTime @default(now())
  level     String   // INFO, WARN, ERROR, DEBUG
  scope     String   // SCANNER, STRATEGY, EXECUTION
  message   String
  context   String?  // JSON blob
}

// NEW: For H/D/W/M/Y Analysis
model PLSnapshot {
  id            String   @id @default(uuid())
  session       Session  @relation(fields: [sessionId], references: [id])
  sessionId     String
  timestamp     DateTime @default(now())
  totalEquity   Float    // Cash + Unrealized value of held tokens
  realizedPnL   Float
  unrealizedPnL Float
}